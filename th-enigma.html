<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../polymer-ui-accordion/polymer-ui-accordion.html">
<link rel="import" href="../polymer-jsonp/polymer-jsonp.html">
<link rel="import" href="../sortable-table/sortable-table.html">

<link rel="import" href="../core-input/core-input.html">

<link rel="import" href="../core-ajax/core-ajax.html">


<polymer-element name="th-enigma" attributes="url">
  <template>
    <style>
      :host{
        font-size: 12px;
        display: block;

      } 
      

    </style>
    <link rel="stylesheet" href="../sortable-table/css/bootstrap.css" shim-shadowdom>
    
<!--     <polymer-jsonp id="jsonp" auto="true" url="{{url}}" response="{{data}}"></polymer-jsonp>
 -->    
<!--     <core-ajax id="ajax" auto="true" url="{{url}}" response="{{data}}"></core-ajax>
 -->

    <core-input value="{{apiKey}}"></core-input>
    <core-input value="{{dataSet}}"></core-input>

 
    <!--<core-input value="{{url}}"></core-input>-->

    <!-- <core-ajax id="ajax" auto url="{{requestUrl}}" withCredentials="false" response="{{data}}"
      params='{"alt":"json", "q":"chrome"}'
      handleAs="json"></core-ajax>
 -->

    
    
     <sortable-table PageSize="10" data="{{tableData}}" class="bootstrap" showFooter="true">

    </sortable-table>
 
  </template>

  <script>

      Polymer('th-enigma', {
        //url:"https://api.enigma.io/v2/stats/"+apiKey+"/"+dataSet+"?select=namefull&operation=frequency",
        //url: "https://api.enigma.io/v2/stats/iTX3qf5cwspm7ryII3ii5zqeHqUuoO4MctfLJFf2xU8eletxHvcI4/us.gov.whitehouse.visitor-list?select=namefull&operation=frequency",
        url: '',
        apiKey: 'iTX3qf5cwspm7ryII3ii5zqeHqUuoO4MctfLJFf2xU8eletxHvcI4',
        dataSet: 'us.gov.whitehouse.visitor-list',
        _META_PATH: 'https://api.enigma.io/v2/meta/',
        _STATS_PATH: 'https://api.enigma.io/v2/stats/',
        _DATA_PATH: 'https://api.enigma.io/v2/data/',

        tableData: null,
        domReady: function() {

          
            var self = this;

            self.url = "https://api.enigma.io/v2/stats/"+self.apiKey+"/"+self.dataSet+"?select=namefull&operation=frequency";

            self._makeCORSCall(self.url, self._displayReturnedData);
            



        },
        _displayReturnedData: function(data) {
            var self = this;
            self.tableData = data.result.frequency;

        },
        _makeCORSCall: function(url, mycallback) {

            var self = this;
            var method = 'GET';
            var xhr = new XMLHttpRequest();
            if ("withCredentials" in xhr) {
              xhr.open(method, url, true);
            } else if (typeof XDomainRequest != "undefined") {
              xhr = new XDomainRequest();
              xhr.open(method, url);
            } else {
              // CORS not supported.
              xhr = null;
            }

            if (!xhr) {
              alert('CORS not supported');
              return;
            }

            // Response handlers.
            xhr.onload = function() {

              var data = JSON.parse(xhr.response);
              mycallback.call(self,data);
              //self._displayReturnedData(data);

            };

            xhr.onerror = function() {
              alert('Woops, there was an error making the request.');
            };

            xhr.send();
            console.log('sent');
        }

       

      });

  </script>
</polymer-element>
